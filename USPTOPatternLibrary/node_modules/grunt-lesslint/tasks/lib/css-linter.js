(function() {
  var CSSLint, CssLinter, _;

  CSSLint = require('csslint').CSSLint;

  _ = require('lodash');

  module.exports = CssLinter = (function() {
    function CssLinter(options, grunt) {
      this.options = options;
      this.grunt = grunt;
    }

    CssLinter.prototype.lint = function(css, callback) {
      var cssLintOptions, enabled, externalOptions, id, result, rules, _ref;
      if (!css) {
        return callback(null, []);
      }
      externalOptions = {};
      rules = _.reduce(CSSLint.getRules(), function(memo, _arg) {
        var id;
        id = _arg.id;
        memo[id] = 1;
        return memo;
      }, {});
      cssLintOptions = this.options.csslint;
      if (cssLintOptions != null ? cssLintOptions.csslintrc : void 0) {
        externalOptions = this.grunt.file.readJSON(cssLintOptions.csslintrc);
        delete cssLintOptions.csslintrc;
      }
      _.extend(cssLintOptions, externalOptions);
      for (id in cssLintOptions) {
        enabled = cssLintOptions[id];
        if (cssLintOptions[id]) {
          rules[id] = cssLintOptions[id];
        } else {
          delete rules[id];
        }
      }
      result = CSSLint.verify(css, rules);
      if (((_ref = result.messages) != null ? _ref.length : void 0) > 0) {
        return callback(null, result);
      } else {
        return callback();
      }
    };

    return CssLinter;

  })();

}).call(this);
